version: 0.2

phases:
  install:
    runtime-versions:
      python: 3.7
      nodejs: 10
    commands:
      - echo install npm packages
      - npm install -g yarn
      - npm install -g serverless
      - yarn install
      - echo install docker
      - yum install -y yum-utils device-mapper-persistent-data lvm2
      - yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
      - yum list docker-ce --showduplicates | sort -r
      - yum install docker-ce-19.03.5 docker-ce-cli-19.03.5 containerd.io
      - systemctl start docker
  build:
    commands:
      - echo Build to CloudFormation
      - serverless deploy -v -s $ENV_NAME
  post_build:
    commands:
      - echo Deployment completed